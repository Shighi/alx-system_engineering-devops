#!/usr/bin/env bash
# Script to install and configure Nginx web server

# Exit on any error
set -e

# Update package list and install nginx
export DEBIAN_FRONTEND=noninteractive
apt-get -y update
apt-get -y install nginx

# Ensure Nginx is running
service nginx start

# Configure the root page to display "Hello World!"
echo "Hello World!" > /var/www/html/index.html

# Ensure Nginx is configured to listen on port 80
if ! grep -q "listen 80 default_server;" /etc/nginx/sites-available/default; then
    sed -i 's/listen \[::\]:80 default_server;/listen 80 default_server;/g' /etc/nginx/sites-available/default
fi

# Set correct permissions for the web root
chown -R www-data:www-data /var/www

# Restart Nginx to apply changes
service nginx restart

# Allow traffic on port 80
ufw allow 80/tcp

echo "Nginx is installed and serving 'Hello World!' on port 80."
